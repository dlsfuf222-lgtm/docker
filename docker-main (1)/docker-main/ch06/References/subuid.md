`/etc/subuid` 파일에 나오는 **subuid**는 리눅스 **User Namespace** 기능의 핵심 개념 중 하나로,
컨테이너나 사용자 네임스페이스 내부에서 **비권한 사용자가 가상적으로 사용할 수 있는 UID 범위**를 정의하는 설정 파일입니다.

아주 쉽게 말해:

> “컨테이너 내부에서 root처럼 보이는 UID 0을 호스트의 특정 비권한 UID 범위로 매핑해주는 지도(map)”

라고 보시면 됩니다.

---

## 📂 **subuid 파일 형식**

```
username:start_uid:range
```

* **username**: 매핑을 적용할 로컬 사용자 계정
* **start\_uid**: 호스트 시스템에서 시작할 UID 번호
* **range**: 매핑할 UID 개수(연속적인 범위)

예시:

```
ubuntu:100000:65536
```

* 사용자 `ubuntu`는
  호스트에서 UID **100000\~165535** 범위를
  컨테이너 내부 UID **0\~65535**로 매핑할 수 있다는 뜻입니다.

---

## 🛠️ **왜 필요한가?**

컨테이너는 내부적으로 UID 0(root)으로 실행되는 경우가 많지만,
이걸 호스트에서도 root(UID 0)으로 두면 보안상 위험합니다.

**User Namespace + subuid** 조합을 쓰면:

* 컨테이너 내부 root(UID 0) → 호스트에서는 일반 UID(100000 같은)
* 컨테이너 탈출 공격에도 **호스트에서는 비권한 계정** 권한만 가짐
* 즉, 보안적으로 한 단계 격리 강화

---

## 🔗 **동작 예시**

컨테이너 실행 시 매핑:

```
컨테이너 내부 UID 0 → 호스트 UID 100000
컨테이너 내부 UID 1 → 호스트 UID 100001
...
컨테이너 내부 UID 65535 → 호스트 UID 165535
```

컨테이너 안에서는 root처럼 보이지만,
호스트 입장에서는 그냥 평범한 비권한 UID일 뿐입니다.

---

## ⚙️ **관련 파일**

* **/etc/subuid** → UID 매핑 정의
* **/etc/subgid** → GID(그룹 ID) 매핑 정의

둘 다 비슷한 역할을 하며, 그룹 권한까지 같이 제한할 수 있습니다.

---

```
ubuntu@ip-172-31-11-19:~$ cat /etc/subuid
ubuntu:100000:65536
dockremap:100000:65536
```

---

`/etc/subuid`에 있는

```
ubuntu:100000:65536
dockremap:100000:65536
```

이 두 라인은 **우분투 OS와 Docker 데몬이 자동으로 생성한 것**입니다. 사람이 직접 쓰는 경우도 있지만, 대부분은 시스템이나 패키지 설치 과정에서 자동으로 작성됩니다. 각각을 조금 더 자세히 살펴보면:

---

##  `ubuntu:100000:65536`

* **작성 주체:** 우분투 설치 시 `adduser` 또는 `useradd` 명령어가 자동 생성
* **의미:**

  * 로컬 사용자 계정 `ubuntu`에게 **100000부터 65536개 UID**를 컨테이너·네임스페이스 매핑용으로 할당
  * 주로 **LXC**, **Podman**, 또는 rootless 컨테이너 실행 시 사용

즉, 일반 유저가 rootless 컨테이너를 만들면 내부 UID 0\~65535가 실제 호스트 UID 100000\~165535에 매핑됩니다.

---

##  `dockremap:100000:65536`

* **작성 주체:** Docker 데몬이 `--userns-remap` 기능을 활성화할 때 자동 생성
* **의미:**

  * `dockremap`이라는 전용 매핑 계정을 만들고 같은 UID 범위를 할당
  * Docker가 **User Namespace Remapping**(rootless security) 기능을 쓸 때 사용

이 덕분에 Docker 컨테이너 내부 root가 호스트에서는 `dockremap`이라는 비권한 사용자로 매핑되어 보안이 강화됩니다.

---

##  자동 생성 흐름 요약

| 계정          | 작성 시점                         | 역할                        |
| ----------- | ----------------------------- | ------------------------- |
| `ubuntu`    | 우분투 사용자 생성 시                  | rootless 컨테이너, LXC 등에서 사용 |
| `dockremap` | Docker `--userns-remap` 활성화 시 | Docker 컨테이너 UID 매핑 전용 계정  |



