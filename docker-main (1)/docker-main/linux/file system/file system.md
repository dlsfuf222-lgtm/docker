파일시스템(filesystem)은 **운영체제가 저장 장치 위에서 데이터를 조직하고 관리하는 방식**을 말합니다. 쉽게 말해, 파일시스템은 **하드디스크·SSD·USB 메모리 같은 블록 단위 저장 장치에 파일과 디렉터리를 체계적으로 배치하고, 읽기·쓰기·삭제 작업을 가능하게 하는 소프트웨어 계층**입니다.


---

## 1. 파일시스템의 기본 개념

* **목적**: 저장 장치 위의 데이터를 **논리적으로 구조화**하여 사용자가 파일/폴더라는 익숙한 형태로 접근할 수 있도록 함.
* **주요 기능**:

  * **이름 기반 접근**: 사용자는 `myfile.txt` 같은 이름으로 접근하지만, 실제 물리 장치에는 블록 단위 데이터만 존재.
  * **메타데이터 관리**: 권한, 소유자, 생성·수정 시간, 크기 등.
  * **공간 관리**: 빈 공간 할당, 해제, 단편화 최소화.
  * **신뢰성**: 전원 장애·커널 크래시에도 데이터 무결성 보장(저널링 등).

---

## 2. 논리적 계층 구조

### (1) 파일시스템 vs 디렉터리 계층

* **파일시스템**: 장치 위의 구조(슈퍼블록, 아이노드, 데이터 블록, 저널…)
* **디렉터리 계층**: `/`(루트)를 중심으로 한 논리적 트리 구조(FHS).
  예: `/home/user/docs/file.txt`

### (2) 계층적 디렉터리 트리

```
/
├── bin      (기본 명령어)
├── etc      (설정 파일)
├── home     (사용자 홈 디렉터리)
│   ├── user1
│   └── user2
├── var      (로그, 캐시)
├── tmp      (임시 파일)
└── usr      (라이브러리, 프로그램)
```

이 트리는 여러 물리적 파티션을 **mount**하여 하나의 루트 트리처럼 보이게 합니다.

---

## 3. 온디스크 구조 (일반적 파일시스템 공통)

대부분의 유닉스 계열 파일시스템(ext4, xfs, btrfs 등)은 아래 구조를 변형하여 사용합니다.

| 계층              | 설명                              |
| --------------- | ------------------------------- |
| **슈퍼블록**        | 전체 FS 메타데이터: 크기, 블록 수, 마운트 정보 등 |
| **블록 그룹/세그먼트**  | 여러 개의 블록 단위로 나눠서 관리             |
| **아이노드(Inode)** | 파일의 메타데이터와 데이터 블록 위치를 저장        |
| **데이터 블록**      | 실제 파일·디렉터리 데이터가 저장되는 영역         |
| **저널**          | 장애 시 복구를 위한 로그(저널링 FS에 한함)      |

---

## 4. 주요 파일시스템 종류

| 파일시스템           | 특징                         | 사용 예시          |
| --------------- | -------------------------- | -------------- |
| **ext2**        | 저널링 없음, 단순 구조              | 초기 리눅스         |
| **ext3**        | 저널링 추가, 안정성 향상             | 전통적 리눅스        |
| **ext4**        | extent, 지연 할당, 대용량 지원, 체크섬 | 최신 리눅스 기본      |
| **XFS**         | 대용량·병렬 성능 우수, 저널링 지원       | RHEL, CentOS   |
| **Btrfs**       | 스냅샷, 서브볼륨, 체크섬, CoW 지원     | SUSE, OpenSUSE |
| **NTFS**        | 저널링, ACL, 대용량 지원, 윈도우 기본   | Windows OS     |
| **FAT32/exFAT** | 단순·범용, 저널링 없음              | USB, SD 카드     |
| **ZFS**         | 풀 기반 관리, 스냅샷, 데이터 무결성      | FreeBSD, NAS   |

---

## 5. 동작 원리 (파일 접근 시 내부 단계)

1. **open()** 호출 → 파일시스템이 파일명 해석 → 아이노드 찾기
2. 아이노드 → 데이터 블록 주소 확인
3. 데이터 블록 → 스토리지 드라이버 통해 실제 디스크 I/O
4. **캐시(Buffer Cache, Page Cache)** 활용해 성능 향상
5. 쓰기 시 → 저널링(메타데이터/데이터) → 본 영역 기록

---

## 6. 저널링과 신뢰성

* **저널링(Journaling)**: 변경 전 메타데이터/데이터를 저널에 먼저 기록 → 장애 시 재실행(replay) 가능
* 모드 예시(ext4):

  * `ordered`: 메타데이터만 저널링, 데이터는 순서 보장
  * `writeback`: 순서 보장 안 함, 빠르지만 위험
  * `journal`: 데이터+메타데이터 전체 저널링, 안전하지만 느림

---

## 7. 마운트(Mount)와 관리 명령어

```bash
# 파일시스템 생성
sudo mkfs.ext4 /dev/sdb1

# 마운트
sudo mount /dev/sdb1 /mnt

# 현재 마운트 상태 확인
mount | grep sdb1
findmnt /mnt

# 언마운트
sudo umount /mnt

# 파일시스템 정보 확인
sudo tune2fs -l /dev/sdb1
df -h       # 사용량
lsblk -f    # 파티션·FS·UUID 확인
```

---

## 8. 요약 다이어그램

```
[ 물리 장치 ]
   │
   ├─ 파티션(/dev/sda1)
   │
   ├─ 파일시스템(ext4, xfs…)
   │    ├─ 슈퍼블록
   │    ├─ 블록그룹/세그먼트
   │    ├─ 아이노드 테이블
   │    ├─ 데이터 블록
   │    └─ 저널
   │
   └─ 마운트 → /mnt/data 또는 /
```

