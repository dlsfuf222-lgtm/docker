
## 1. 리눅스의 마운트(Mount) 개념

리눅스에서 **마운트(Mount)** 란, **블록 디바이스에 있는 파일시스템을 리눅스 디렉터리 계층 구조에 연결** 하는 과정을 의미합니다.

### 핵심 포인트

* 리눅스는 **단일 계층(Unix-like VFS 구조)**을 사용 → 모든 파일시스템을 `/`(루트) 아래에 붙임.
* **드라이브 문자(C:, D:)** 같은 개념이 없음 → 대신 `/mnt/usb`, `/media/user/USB` 같은 디렉터리에 마운트.

---

## 2. 마운트 과정의 내부 동작

마운트 시 리눅스 커널의 동작은 다음과 같은 계층을 거칩니다:

```
[사용자 공간]        mount 명령어, systemd-udevd, udisks2
      ↓
[VFS 계층]          Virtual File System (커널 추상화 계층)
      ↓
[파일시스템 드라이버] ext4, xfs, btrfs, vfat 등
      ↓
[블록 디바이스 계층] /dev/sdX, /dev/nvmeXnY
      ↓
[물리 디바이스]      HDD, SSD, USB, NVMe
```

* **VFS(Virtual File System)**: 모든 파일시스템을 단일 API로 추상화.
* **파일시스템 드라이버**: 특정 파일시스템을 해석(ext4, FAT32 등).
* **블록 디바이스 계층**: 실제 I/O 요청을 디바이스로 전달.

---

## 3. 마운트 명령어와 예시

```bash
# USB 메모리를 /mnt/usb 디렉터리에 마운트
mount /dev/sdb1 /mnt/usb
```

* `/dev/sdb1`: 블록 디바이스(USB 메모리 첫 번째 파티션)
* `/mnt/usb`: 마운트 포인트 디렉터리(미리 만들어야 함)

---

## 4. USB 메모리 Insert 시 자동 마운트 과정

### (1) 하드웨어 레벨

* USB 포트에 메모리를 삽입하면 **USB 컨트롤러**가 장치를 인식.
* USB Storage 클래스 드라이버(`usb-storage.ko`)가 장치를 SCSI 계층에 노출.

### (2) SCSI 계층 → 블록 디바이스 생성

* SCSI 계층이 새 장치를 스캔하여 `/dev/sdb` 같은 **블록 디바이스 노드**를 생성.
* 파티션 테이블(GPT/MBR)을 읽고 `/dev/sdb1` 같은 파티션 노드 생성.

### (3) udev 이벤트

* 커널이 **udev**에 이벤트를 전달.
* `/dev/disk/by-uuid`, `/dev/disk/by-label` 심볼릭 링크 생성.
* **systemd-udevd** 또는 **udisks2**가 자동 마운트 수행(데스크톱 환경에서).

### (4) 파일시스템 드라이버 로딩

* `ext4`, `vfat` 같은 파일시스템 드라이버가 로드되어 VFS에 연결.

### (5) 마운트 포인트에 연결

* 최종적으로 `/media/$USER/USB_DISK` 같은 경로에 자동 마운트됨(GUI 환경에서는 아이콘까지 표시).

---

## 5. 자동 마운트 vs 수동 마운트

| 구분    | 수동 마운트                     | 자동 마운트                        |
| ----- | -------------------------- | ----------------------------- |
| 명령어   | `mount /dev/sdb1 /mnt/usb` | `udisks2`, `systemd-udevd` 사용 |
| 설정 파일 | `/etc/fstab`               | `/etc/udev/rules.d/`          |
| 사용 사례 | 서버, 수동 관리 환경               | 데스크톱, 편의성 중심 환경               |

---

## 6. 마운트 상태 확인 및 해제

```bash
# 마운트된 파일시스템 목록
mount | grep sdb1

# 해제
umount /mnt/usb
```

---

## 7. 내부 흐름 요약

```
[USB 삽입]
   ↓ (USB Storage 드라이버)
[SCSI 서브시스템]
   ↓ (블록 디바이스 생성)
[/dev/sdb1 노드 생성 - udev]
   ↓ (파일시스템 드라이버 로딩)
[VFS 계층 연결]
   ↓ (마운트 포인트에 연결)
[/mnt/usb에서 접근 가능]
```
